# action.yml
name: 'MetadataMapper'
description: 'Start MetadataMapper and make Request'
outputs:
  post-result: # id of output
    description: 'result of the post request'
    value: ${{ steps.result.outputs.post-result }}
runs:
  using: 'composite'
  steps:
    - uses: actions/checkout@v2
#    - uses: actions/setup-python@v3
#      with:
#        python-version: '3.8.x'
#    - name: Start Metadatamapper
#      run: |
#        python -m pip install --upgrade pip
#        pip install -r requirements.txt
#        python --version
#        python ./v1/__init__.py &
#      shell: bash
    - name: Start MetadataMapper
      run: | 
        docker build -t metadatamapper .
        docker run -e HOST_IP='0.0.0.0' -p 5000:5000/tcp metadatamapper &
      shell: bash
    - id: result
      run: |
        sudo apt-get update >/dev/null; sudo apt-get install -y curl >/dev/null
        response=$(curl -s -X GET -H 'Content-Type:application/json' http://localhost:5000/mapping)
        echo test2
        echo $response
        echo $(::set-output name=post-result::$response)
      shell: sh